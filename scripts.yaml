toggle_main_lights:
  alias: Toggle All Main Lights
  mode: single
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: light.kitchen_light_switch
              state: "off"
            - condition: state
              entity_id: light.great_room_fan_and_light
              state: "off"
            - condition: state
              entity_id: light.dining_room_main_light
              state: "off"
            - condition: state
              entity_id: switch.master_hallway
              state: "off"
          sequence:
            - service: light.turn_on
              target:
                entity_id:
                  - light.kitchen_light_switch
                  - light.great_room_fan_and_light
                  - light.dining_room_main_light
            - service: switch.turn_on
              target:
                entity_id:
                  - switch.master_hallway
      default:
        - service: light.turn_off
          target:
            entity_id:
              - light.kitchen_light_switch
              - light.great_room_fan_and_light
              - light.dining_room_main_light
        - service: switch.turn_off
          target:
            entity_id:
              - switch.master_hallway
        - choose:
            - conditions:
                - condition: numeric_state
                  entity_id: cover.great_room_blinds
                  attribute: current_tilt_position
                  below: 95
              sequence:
                - service: cover.set_cover_tilt_position
                  target:
                    entity_id: cover.great_room_blinds
                  data:
                    tilt_position: 99
        - choose:
            - conditions:
                - condition: numeric_state
                  entity_id: cover.dining_room_blinds
                  attribute: current_tilt_position
                  below: 95
              sequence:
                - service: cover.set_cover_tilt_position
                  target:
                    entity_id: cover.dining_room_blinds
                  data:
                    tilt_position: 99

# ============================================
# Spotify Transfer Script
# ============================================

spotify_send_to:
  alias: "Spotify: Send to Speaker"
  icon: mdi:spotify
  description: "Transfer Spotify playback to any speaker and auto-resume."
  fields:
    speaker:
      description: "Target speaker"
      example: "Kitchen dot"
      required: true
      selector:
        select:
          options:
            - "Kitchen dot"
            - "Family dot"
            - "Kit and fam"
            - "Bose Home Speaker 300"
            - "P13PRO"
            - "Casa de Sowu"
            - "Living Room TV"
  mode: single
  sequence:
    - choose:
        # Bose: use native device ID to bypass Chromecast path
        - conditions:
            - condition: template
              value_template: "{{ speaker == 'Bose Home Speaker 300' }}"
          sequence:
            - service: spotifyplus.player_transfer_playback
              data:
                entity_id: media_player.spotifyplus_paul_sowu
                device_id: "5190deba7802ce444af01686633f06d33dc25540"
                play: true
                force_activate_device: false
      # P13PRO tablet: wake screen first so Spotify registers in Connect list
        - conditions:
            - condition: template
              value_template: "{{ speaker == 'P13PRO' }}"
          sequence:
            - service: button.press
              target:
                entity_id: button.vaca_ea80840db_wake_screen
            - delay:
                seconds: 4
            - service: media_player.select_source
              data:
                entity_id: media_player.spotifyplus_paul_sowu
                source: "P13PRO"
            - delay:
                milliseconds: 1500
            - service: media_player.media_play
              data:
                entity_id: media_player.spotifyplus_paul_sowu
      # All other devices: select_source + resume
      default:
        - service: media_player.select_source
          data:
            entity_id: media_player.spotifyplus_paul_sowu
            source: "{{ speaker }}"
        - delay:
            milliseconds: 1500
        - service: media_player.media_play
          data:
            entity_id: media_player.spotifyplus_paul_sowu
