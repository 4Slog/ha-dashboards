- id: maintain_comfort_band_71_73
  alias: Maintain Comfort Band 71–73°F
  description: Automatically switch HVAC between heat and cool to keep average home temperature in the 71–73°F comfort band.
  mode: single

  trigger:
    - platform: numeric_state
      entity_id: sensor.average_home_temperature
      below: 71
      for:
        minutes: 10

    - platform: numeric_state
      entity_id: sensor.average_home_temperature
      above: 73
      for:
        minutes: 10

  # Only run when your master toggle is ON
  condition:
    - condition: state
      entity_id: input_boolean.hvac_auto_comfort
      state: "on"

  action:
    - choose:

        # === HEAT WHEN TOO COLD (<71°F) ===
        - conditions:
            - condition: numeric_state
              entity_id: sensor.average_home_temperature
              below: 71
          sequence:
            - service: climate.set_hvac_mode
              target:
                entity_id: climate.thermostat
              data:
                hvac_mode: heat
            - service: climate.set_temperature
              target:
                entity_id: climate.thermostat
              data:
                temperature: 72

        # === COOL WHEN TOO HOT (>73°F) ===
        - conditions:
            - condition: numeric_state
              entity_id: sensor.average_home_temperature
              above: 73
          sequence:
            - service: climate.set_hvac_mode
              target:
                entity_id: climate.thermostat
              data:
                hvac_mode: cool
            - service: climate.set_temperature
              target:
                entity_id: climate.thermostat
              data:
                temperature: 72

    # LOG RESULT
    - service: logbook.log
      data:
        name: HVAC Comfort Band
        message: System adjusted to maintain 71–73°F comfort range.

- id: hvac_fan_circulation_hourly
  alias: HVAC Fan Circulation Hourly
  description: Run system fan 10 minutes every hour when comfort automation is enabled and HVAC is idle.
  mode: single

  trigger:
    # Top of every hour
    - platform: time_pattern
      minutes: "0"

  condition:
    # Only if auto comfort is ON
    - condition: state
      entity_id: input_boolean.hvac_auto_comfort
      state: "on"
    # Only if HVAC is currently OFF (not actively heating or cooling)
    - condition: state
      entity_id: climate.thermostat
      state: "off"

  action:
    - service: climate.set_fan_mode
      target:
        entity_id: climate.thermostat
      data:
        fan_mode: "on"

    - delay: "00:10:00"

    - service: climate.set_fan_mode
      target:
        entity_id: climate.thermostat
      data:
        fan_mode: "auto"

- id: doorbell_front_door_popup_kitchen_tablet
  alias: 'Doorbell Front Door Popup - Kitchen Tablet'
  mode: single
  trigger:
    - platform: state
      entity_id: event.front_door_ding_2
  action:
    - service: browser_mod.popup
      data:
        title: Front Door
        device_id: browser_mod_c145c9d9_9dc38c06
        content:
          type: picture-entity
          entity: camera.front_door_live_view_2
          camera_view: live
        timeout: 30000

- id: main_lights_master_on
  alias: Main Lights Master On
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.main_lights_master
      to: "on"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.kitchen_light_switch
          - light.great_room_fan_and_light

- id: main_lights_master_off
  alias: Main Lights Master Off
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.main_lights_master
      to: "off"
  action:
    - service: light.turn_off
      target:
        entity_id:
          - light.kitchen_light_switch
          - light.great_room_fan_and_light
- id: hp_motion_detected
  alias: HP Motion Detected
  description: Triggered when HP webcam detects motion
  mode: single
  trigger:
    - platform: webhook
      webhook_id: hp_motion_detected
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.hp_presence

- id: hp_motion_cleared
  alias: HP Motion Cleared
  description: Triggered when HP webcam motion clears
  mode: single
  trigger:
    - platform: webhook
      webhook_id: hp_motion_cleared
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.hp_presence

- id: doorbell_fullscreen_camera_fully_kiosk
  alias: "Doorbell - Show Camera on Kitchen Tablet (Fully Kiosk)"
  description: "When doorbell rings, wake tablet and show front door camera fullscreen"
  mode: single
  max_exceeded: silent

  trigger:
    - platform: state
      entity_id: event.front_door_ding_2
      not_from:
        - "unknown"
        - "unavailable"

  action:
    # Step 1: Wake the screen
    - service: switch.turn_on
      target:
        entity_id: switch.kitchentablet_screen

    # Step 2: Load fullscreen camera view
    - service: fully_kiosk.load_url
      target:
        device_id: a7d6569ad4d0ec18c24a1be99059f13f
      data:
        url: "http://10.0.0.60:8123/command-center/doorbell-fullscreen"

    # Step 3: Wait 45 seconds
    - delay:
        seconds: 45

    # Step 4: Return to main dashboard
    - service: fully_kiosk.load_url
      target:
        device_id: a7d6569ad4d0ec18c24a1be99059f13f
      data:
        url: "http://10.0.0.60:8123/command-center/media"

- id: great_room_blinds_open_1130
  alias: "Great Room Blinds - Open at 11:30 AM if Still Closed"
  description: "If great room blinds haven't been manually opened by 11:30 AM, tilt them open"
  mode: single
  trigger:
    - platform: time
      at: "08:00:00"
  condition:
    - condition: state
      entity_id: input_boolean.great_room_blinds_auto
      state: "on"
    - condition: numeric_state
      entity_id: cover.great_room_blinds
      attribute: current_tilt_position
      above: 90
  action:
    - service: cover.set_cover_tilt_position
      target:
        entity_id: cover.great_room_blinds
      data:
        tilt_position: 78

- id: great_room_blinds_close_530
  alias: "Great Room Blinds - Close at 5:30 PM"
  description: "Close great room blinds at 5:30 PM every day"
  mode: single
  trigger:
    - platform: time
      at: "17:30:00"
  condition:
    - condition: state
      entity_id: input_boolean.great_room_blinds_auto
      state: "on"
  action:
    - service: cover.set_cover_tilt_position
      target:
        entity_id: cover.great_room_blinds
      data:
        tilt_position: 99

- id: study_blinds_open_weekday
  alias: "Study Blinds - Open Weekday Morning"
  description: "Tilt study blinds open at 7:55 AM Mon-Fri for wife's work schedule"
  mode: single
  trigger:
    - platform: time
      at: "07:55:00"
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.study_blinds_auto
      state: "on"
  action:
    - service: cover.set_cover_tilt_position
      target:
        entity_id: cover.blind_tilt_5b8c
      data:
        tilt_position: 70

- id: study_blinds_close_weekday
  alias: "Study Blinds - Close Weekday Evening"
  description: "Tilt study blinds closed at 5:30 PM Mon-Fri after wife's work"
  mode: single
  trigger:
    - platform: time
      at: "17:30:00"
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.study_blinds_auto
      state: "on"
  action:
    - service: cover.set_cover_tilt_position
      target:
        entity_id: cover.blind_tilt_5b8c
      data:
        tilt_position: 100
