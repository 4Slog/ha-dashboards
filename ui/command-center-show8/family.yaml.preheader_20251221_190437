title: Family
path: family
icon: mdi:map-marker-account
panel: true
theme: default

cards:
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: 1fr
      grid-auto-rows: min-content
      justify-content: stretch
      align_content: start
      gap: 16px
      padding: 16px
    cards:
      # === HEADER (DATE | GREETING | TIME) ===
      - type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: auto 1fr auto
          gap: 32px
        cards:
          - type: markdown
            content: |
              {{ now().strftime('%A, %b %d') }}
            card_mod:
              style: |
                ha-card {
                  box-shadow: none;
                  background: transparent;
                  padding: 8px 0 !important;
                  text-align: left;
                  font-size: 1.8rem;
                  font-weight: 500;
                }
          - type: markdown
            content: |
              {% set h = now().hour %}
              {% if 5 <= h < 12 %}
                {% set greet = 'Good morning' %}
              {% elif 12 <= h < 17 %}
                {% set greet = 'Good afternoon' %}
              {% elif 17 <= h < 22 %}
                {% set greet = 'Good evening' %}
              {% else %}
                {% set greet = 'Good night' %}
              {% endif %}
              {{ greet }}
            card_mod:
              style: |
                ha-card {
                  box-shadow: none;
                  background: transparent;
                  padding: 8px 0 !important;
                  text-align: center;
                  font-size: 3.2rem;
                  font-weight: 600;
                }
          - type: markdown
            content: |
              {{ now().strftime('%I:%M %p') }}
            card_mod:
              style: |
                ha-card {
                  box-shadow: none;
                  background: transparent;
                  padding: 8px 0 !important;
                  text-align: right;
                  font-size: 1.8rem;
                  font-weight: 500;
                }

      # === 5-BUTTON RIBBON ===
      - type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: repeat(6, 1fr)
          gap: 10px
        cards:
          # Media Button
          - type: custom:mushroom-template-card
            primary: Media
            icon: mdi:lightbulb-group-music
            icon_color: blue
            tap_action:
              action: navigate
              navigation_path: /command-center/media
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
                  background: linear-gradient(135deg, rgba(79, 172, 254, 0.25) 0%, rgba(0, 242, 254, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 2px solid rgba(255, 255, 255, 0.2);
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

          # Lights Button
          - type: custom:mushroom-template-card
            primary: Lights
            icon: mdi:lightbulb-group
            icon_color: purple
            tap_action:
              action: navigate
              navigation_path: /command-center/home
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
                  background: linear-gradient(135deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 2px solid rgba(255, 255, 255, 0.2);
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

          # Weather Button
          - type: custom:mushroom-template-card
            primary: Weather
            icon: mdi:weather-partly-cloudy
            icon_color: blue
            tap_action:
              action: navigate
              navigation_path: /command-center/weather
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
                  background: linear-gradient(135deg, rgba(79, 172, 254, 0.25) 0%, rgba(0, 242, 254, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 2px solid rgba(255, 255, 255, 0.2);
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

          # Calendar Button
          - type: custom:mushroom-template-card
            primary: Calendar
            icon: mdi:calendar-clock
            icon_color: green
            tap_action:
              action: navigate
              navigation_path: /command-center/calendar
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
                  background: linear-gradient(135deg, rgba(67, 233, 123, 0.25) 0%, rgba(56, 249, 215, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 2px solid rgba(255, 255, 255, 0.2);
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

          # Family Button (ACTIVE)
          - type: custom:mushroom-template-card
            primary: Family
            icon: mdi:map-marker-account
            icon_color: purple
            tap_action:
              action: navigate
              navigation_path: /command-center/family
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 6px 20px rgba(250, 112, 154, 0.6);
                  background: linear-gradient(135deg, rgba(250, 112, 154, 0.25) 0%, rgba(254, 225, 64, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 3px solid #FFFFFF;
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

          # Front Door Button
          - type: custom:mushroom-template-card
            primary: Front Door
            icon: mdi:shield-home
            icon_color: orange
            tap_action:
              action: navigate
              navigation_path: /command-center/frontdoor
            card_mod:
              style: |
                ha-card {
                  border-radius: 16px;
                  box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
                  background: linear-gradient(135deg, rgba(240, 147, 251, 0.25) 0%, rgba(245, 87, 108, 0.25) 100%);
                  transition: all 0.3s ease;
                  height: 50px;
                  border: 2px solid rgba(255, 255, 255, 0.2);
                  font-size: 1.6rem !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                ha-card:active {
                  transform: scale(0.98);
                }

      # === ARROWS ===
      - type: horizontal-stack
        cards:
          - type: custom:button-card
            icon: mdi:chevron-left
            tap_action:
              action: navigate
              navigation_path: /command-center/calendar
            styles:
              card:
                - height: 70px
                - width: 70px
                - border-radius: 50%
                - object-fit: cover
                - background: rgba(74, 158, 255, 0.95)
                - box-shadow: 0 4px 16px rgba(74, 158, 255, 0.5)
              icon:
                - width: 42px
                - height: 42px
                - color: white
              grid:
                - grid-template-areas: '"i"'
          - type: custom:button-card
            color_type: blank-card
            styles:
              card:
                - background: transparent
                - box-shadow: none
          - type: custom:button-card
            icon: mdi:chevron-right
            tap_action:
              action: navigate
              navigation_path: /command-center/frontdoor
            styles:
              card:
                - height: 70px
                - width: 70px
                - border-radius: 50%
                - object-fit: cover
                - background: rgba(74, 158, 255, 0.95)
                - box-shadow: 0 4px 16px rgba(74, 158, 255, 0.5)
              icon:
                - width: 42px
                - height: 42px
                - color: white
              grid:
                - grid-template-areas: '"i"'

      # === FAMILY LOCATION BANNER (30px height) ===
      - type: custom:button-card
        name: FAMILY LOCATION
        icon: mdi:map-marker-account
        show_name: true
        show_icon: true
        tap_action:
          action: none
        styles:
          card:
            - height: 30px
            - border-radius: 8px
            - background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)
            - box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3)
            - padding: 0 12px
          grid:
            - grid-template-areas: '"i n"'
            - grid-template-columns: auto 1fr
          icon:
            - width: 18px
            - height: 18px
            - color: white
            - margin-right: 8px
          name:
            - font-size: 1.1rem
            - font-weight: 700
            - color: white
            - justify-self: start
            - letter-spacing: 0.5px

      # === 3 PERSON CARDS (Paul, Tuella, Mauriece) ===
      - type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: repeat(3, 1fr)
          gap: 16px
        cards:
          # === PAUL'S CARD (Life360 + Waze) ===
          - type: custom:button-card
            entity: device_tracker.paul_360
            name: Paul
            show_entity_picture: true
            show_name: true
            show_state: false
            show_entity_picture: false
            icon: mdi:account
            custom_fields:
              battery: |
                [[[
                  const tracker = states['device_tracker.paul_360'];
                  if (tracker && tracker.attributes.battery_level) {
                    const charging = tracker.attributes.battery_charging ? '‚ö°' : 'üîã';
                    return `<span style="font-size: 1.1rem;">${charging} ${tracker.attributes.battery_level}%</span>`;
                  }
                  return '';
                ]]]
              status: |
                [[[
                  const tracker = states['device_tracker.paul_360'];
                  const waze = states['sensor.paul_time_to_home'];
                  
                  if (!tracker) return '';
                  
                  // At home
                  if (tracker.state === 'home') {
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üè† Home</span>`;
                  }
                  
                  // Driving with Waze ETA
                  if (tracker.attributes.driving && waze && waze.state !== 'unavailable' && parseFloat(waze.state) > 0) {
                    const time = Math.round(parseFloat(waze.state));
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving - ${time} min to home</span>`;
                  }
                  
                  // Driving (no valid ETA)
                  if (tracker.attributes.driving) {
                    const speed = tracker.attributes.speed || 0;
                    if (speed > 0) {
                      return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving ${speed} mph</span>`;
                    }
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving</span>`;
                  }
                  
                  // At a place
                  if (tracker.attributes.place && tracker.attributes.place !== 'null') {
                    return `<span style="font-size: 1.2rem; font-weight: 600;">üìç At ${tracker.attributes.place}</span>`;
                  }
                  
                  // Away (unknown location)
                  return `<span style="font-size: 1.3rem; font-weight: 600;">üìç Away</span>`;
                ]]]
              location_detail: |
                [[[
                  const tracker = states['device_tracker.paul_360'];
                  
                  if (!tracker || tracker.state === 'home') return '';
                  
                  const address = tracker.attributes.address || '';
                  if (address && address.length > 0) {
                    // Shorten address if too long
                    if (address.length > 50) {
                      return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address.substring(0, 47)}...</span>`;
                    }
                    return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address}</span>`;
                  }
                  return '';
                ]]]
            styles:
              card:
                - height: 260px
                - border-radius: 16px
                - background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)
                - box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3)
                - padding: 16px
              grid:
                - grid-template-areas: '"i" "n" "battery" "status" "location_detail"'
                - grid-template-rows: 100px auto auto auto 1fr
              img_cell:
                - width: 100px
                - height: 100px
                - border-radius: 50%
                - object-fit: cover
                - border: 3px solid white
                - justify-self: center
                - margin-bottom: 8px
              name:
                - font-size: 1.5rem
                - font-weight: 700
                - color: white
                - justify-self: center
                - margin-bottom: 8px
              custom_fields:
                battery:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 8px
                status:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 4px
                  - text-align: center
                  - padding: 0 8px
                location_detail:
                  - justify-self: center
                  - text-align: center
                  - padding: 0 8px

          # === TUELLA'S CARD (Life360 + Waze) ===
          - type: custom:button-card
            entity: device_tracker.tuella_360
            name: Tuella
            show_entity_picture: true
            show_name: true
            show_state: false
            entity_picture: |
              [[[
                // Use HA user picture, not Life360 picture
                const person = states['person.tuella_sowu'];
                if (person && person.attributes.entity_picture) {
                  const pic = person.attributes.entity_picture;
                  if (!pic.includes('life360.com')) {
                    return pic;
                  }
                }
                return '/local/default_user.png';
              ]]]
            custom_fields:
              battery: |
                [[[
                  const tracker = states['device_tracker.tuella_360'];
                  if (tracker && tracker.attributes.battery_level) {
                    const charging = tracker.attributes.battery_charging ? '‚ö°' : 'üîã';
                    return `<span style="font-size: 1.1rem;">${charging} ${tracker.attributes.battery_level}%</span>`;
                  }
                  return '';
                ]]]
              status: |
                [[[
                  const tracker = states['device_tracker.tuella_360'];
                  const waze = states['sensor.tuella_time_to_home'];
                  
                  if (!tracker) return '';
                  
                  // At home
                  if (tracker.state === 'home') {
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üè† Home</span>`;
                  }
                  
                  // Driving with Waze ETA
                  if (tracker.attributes.driving && waze && waze.state !== 'unavailable' && parseFloat(waze.state) > 0) {
                    const time = Math.round(parseFloat(waze.state));
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving - ${time} min to home</span>`;
                  }
                  
                  // Driving (no valid ETA)
                  if (tracker.attributes.driving) {
                    const speed = tracker.attributes.speed || 0;
                    if (speed > 0) {
                      return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving ${speed} mph</span>`;
                    }
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving</span>`;
                  }
                  
                  // At a place
                  if (tracker.attributes.place && tracker.attributes.place !== 'null') {
                    return `<span style="font-size: 1.2rem; font-weight: 600;">üìç At ${tracker.attributes.place}</span>`;
                  }
                  
                  // Away (unknown location)
                  return `<span style="font-size: 1.3rem; font-weight: 600;">üìç Away</span>`;
                ]]]
              location_detail: |
                [[[
                  const tracker = states['device_tracker.tuella_360'];
                  
                  if (!tracker || tracker.state === 'home') return '';
                  
                  const address = tracker.attributes.address || '';
                  if (address && address.length > 0) {
                    if (address.length > 50) {
                      return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address.substring(0, 47)}...</span>`;
                    }
                    return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address}</span>`;
                  }
                  return '';
                ]]]
            styles:
              card:
                - height: 260px
                - border-radius: 16px
                - background: linear-gradient(135deg, #fa709a 0%, #fee140 100%)
                - box-shadow: 0 4px 12px rgba(250, 112, 154, 0.3)
                - padding: 16px
              grid:
                - grid-template-areas: '"i" "n" "battery" "status" "location_detail"'
                - grid-template-rows: 100px auto auto auto 1fr
              img_cell:
                - width: 100px
                - height: 100px
                - border-radius: 50%
                - object-fit: cover
                - border: 3px solid white
                - justify-self: center
                - margin-bottom: 8px
              name:
                - font-size: 1.5rem
                - font-weight: 700
                - color: white
                - justify-self: center
                - margin-bottom: 8px
              custom_fields:
                battery:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 8px
                status:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 4px
                  - text-align: center
                  - padding: 0 8px
                location_detail:
                  - justify-self: center
                  - text-align: center
                  - padding: 0 8px

          # === MAURIECE'S CARD (Life360 + Waze) ===
          - type: custom:button-card
            entity: device_tracker.mauriece_360
            name: Mauriece
            show_entity_picture: true
            show_name: true
            show_state: false
            entity_picture: |
              [[[
                // Use HA user picture, not Life360 picture
                const person = states['person.mauriece'];
                if (person && person.attributes.entity_picture) {
                  const pic = person.attributes.entity_picture;
                  if (!pic.includes('life360.com')) {
                    return pic;
                  }
                }
                return '/local/default_user.png';
              ]]]
            custom_fields:
              battery: |
                [[[
                  const tracker = states['device_tracker.mauriece_360'];
                  if (tracker && tracker.attributes.battery_level) {
                    const charging = tracker.attributes.battery_charging ? '‚ö°' : 'üîã';
                    return `<span style="font-size: 1.1rem;">${charging} ${tracker.attributes.battery_level}%</span>`;
                  }
                  return '';
                ]]]
              status: |
                [[[
                  const tracker = states['device_tracker.mauriece_360'];
                  const waze = states['sensor.mauriece_time_to_home'];
                  
                  if (!tracker) return '';
                  
                  // At home
                  if (tracker.state === 'home') {
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üè† Home</span>`;
                  }
                  
                  // Driving with Waze ETA
                  if (tracker.attributes.driving && waze && waze.state !== 'unavailable' && parseFloat(waze.state) > 0) {
                    const time = Math.round(parseFloat(waze.state));
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving - ${time} min to home</span>`;
                  }
                  
                  // Driving (no valid ETA)
                  if (tracker.attributes.driving) {
                    const speed = tracker.attributes.speed || 0;
                    if (speed > 0) {
                      return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving ${speed} mph</span>`;
                    }
                    return `<span style="font-size: 1.3rem; font-weight: 600;">üöó Driving</span>`;
                  }
                  
                  // At a place
                  if (tracker.attributes.place && tracker.attributes.place !== 'null') {
                    return `<span style="font-size: 1.2rem; font-weight: 600;">üìç At ${tracker.attributes.place}</span>`;
                  }
                  
                  // Away (unknown location)
                  return `<span style="font-size: 1.3rem; font-weight: 600;">üìç Away</span>`;
                ]]]
              location_detail: |
                [[[
                  const tracker = states['device_tracker.mauriece_360'];
                  
                  if (!tracker || tracker.state === 'home') return '';
                  
                  const address = tracker.attributes.address || '';
                  if (address && address.length > 0) {
                    if (address.length > 50) {
                      return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address.substring(0, 47)}...</span>`;
                    }
                    return `<span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">${address}</span>`;
                  }
                  return '';
                ]]]
            styles:
              card:
                - height: 260px
                - border-radius: 16px
                - background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)
                - box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3)
                - padding: 16px
              grid:
                - grid-template-areas: '"i" "n" "battery" "status" "location_detail"'
                - grid-template-rows: 100px auto auto auto 1fr
              img_cell:
                - width: 100px
                - height: 100px
                - border-radius: 50%
                - object-fit: cover
                - border: 3px solid white
                - justify-self: center
                - margin-bottom: 8px
              name:
                - font-size: 1.5rem
                - font-weight: 700
                - color: white
                - justify-self: center
                - margin-bottom: 8px
              custom_fields:
                battery:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 8px
                status:
                  - justify-self: center
                  - color: white
                  - margin-bottom: 4px
                  - text-align: center
                  - padding: 0 8px
                location_detail:
                  - justify-self: center
                  - text-align: center
                  - padding: 0 8px

      # === NATIVE HA MAP (70% width, square, centered, bordered) ===
      - type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: 15% 70% 15%
          gap: 0
        cards:
          # Left spacer
          - type: custom:button-card
            color_type: blank-card
            styles:
              card:
                - background: transparent
                - box-shadow: none

          # Native map container
          - type: map
            entities:
              - device_tracker.paul_360
              - device_tracker.tuella_360
              - device_tracker.mauriece_360
              - zone.home
            hours_to_show: 0.5
            default_zoom: 15
            dark_mode: true
            card_mod:
              style: |
                ha-card {
                  aspect-ratio: 1 / 1;
                  border-radius: 16px;
                  border: 3px solid rgba(102, 126, 234, 0.5);
                  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                  overflow: hidden;
                }

          # Right spacer
          - type: custom:button-card
            color_type: blank-card
            styles:
              card:
                - background: transparent
                - box-shadow: none
