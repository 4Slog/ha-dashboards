type: vertical-stack
cards:
  - type: heading
    heading: Lights
    heading_style: title
    icon: mdi:lightbulb-group-outline
    card_mod:
      style: |
        ha-card {
          font-size: 1.3rem !important;
          margin-bottom: 8px;
        }

  - type: grid
    columns: 2
    square: false
    card_mod:
      style: |
        ha-card {
          max-width: 100% !important;
          box-sizing: border-box !important;
          gap: 12px;
        }
    cards:
      # Great Room Light
      - type: custom:button-card
        entity: light.great_room_fan_and_light
        name: Great Room Light
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    const rgb = entity.attributes.rgb_color || [255, 255, 255];
                    return `linear-gradient(135deg, rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, 0.3) 0%, rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, 0.6) 100%)`;
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  if (entity.state === 'on') {
                    const rgb = entity.attributes.rgb_color || [255, 255, 255];
                    return `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
                  }
                  return '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
            - font-weight: 500
          state:
            - font-size: 0.85rem
            - margin-top: 4px
            - margin-top: 4px

      # Great Room Fan
      - type: custom:button-card
        entity: fan.great_room_fan_and_light
        name: Great Room Fan
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #00c6ff 0%, #0072ff 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#00d4ff' : '#666';
                ]]]
            - animation: |
                [[[
                  return entity.state === 'on' ? 'rotation 2s linear infinite' : 'none';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Dining Room Light
      - type: custom:button-card
        entity: light.dining_room_main_light
        name: Dining Room Light
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#fdcb6e' : '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Dining Room Fan
      - type: custom:button-card
        entity: fan.dining_room_main_fan
        name: Dining Room Fan
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#74b9ff' : '#666';
                ]]]
            - animation: |
                [[[
                  return entity.state === 'on' ? 'rotation 2s linear infinite' : 'none';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Kitchen Light
      - type: custom:button-card
        entity: light.kitchen_light_switch
        name: Kitchen Light
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #55efc4 0%, #00b894 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#00b894' : '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Master Hallway
      - type: custom:button-card
        entity: switch.master_hallway
        name: Master Hallway
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #ff9ff3 0%, #ff6b9d 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#ff6b9d' : '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Master Bedroom Light
      - type: custom:button-card
        entity: light.master_bedroom
        name: Master Bedroom
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#a29bfe' : '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Master Bedroom Fan
      - type: custom:button-card
        entity: fan.master_bedroom
        name: Master Fan
        show_state: true
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  if (entity.state === 'on') {
                    return 'linear-gradient(135deg, #00cec9 0%, #0984e3 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  return entity.state === 'on' ? '#00cec9' : '#666';
                ]]]
            - animation: |
                [[[
                  return entity.state === 'on' ? 'rotation 2s linear infinite' : 'none';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px
          state:
            - font-size: 0.85rem
            - margin-top: 4px

      # Common Area Toggle
      - type: custom:button-card
        name: Common Area
        icon: mdi:lightbulb-multiple
        show_state: false
        tap_action:
          action: call-service
          service: script.toggle_main_lights
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  const lights = [
                    states['light.great_room_fan_and_light'].state,
                    states['light.dining_room_main_light'].state,
                    states['light.kitchen_light_switch'].state,
                    states['switch.master_hallway'].state
                  ];
                  const anyOn = lights.some(s => s === 'on');
                  if (anyOn) {
                    return 'linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%)';
                  }
                  return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  const lights = [
                    states['light.great_room_fan_and_light'].state,
                    states['light.dining_room_main_light'].state,
                    states['light.kitchen_light_switch'].state,
                    states['switch.master_hallway'].state
                  ];
                  return lights.some(s => s === 'on') ? '#ffeaa7' : '#666';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 12px

      # Study Blinds
      - type: custom:button-card
        entity: cover.blind_tilt_5b8c
        name: Study Blinds
        show_state: false
        tap_action:
          action: call-service
          service: cover.set_cover_tilt_position
          service_data:
            entity_id: cover.blind_tilt_5b8c
            tilt_position: |
              [[[
                const pos = entity.attributes.current_tilt_position;
                // If closed (0-5% or 95-100%), open to 70%
                if (pos <= 5 || pos >= 95) {
                  return 70;
                }
                // Otherwise, close to 100%
                return 100;
              ]]]
        hold_action:
          action: more-info
        custom_fields:
          motion: |
            [[[
              const state = entity.state;
              if (state === 'opening') {
                return `<span style="font-size: 0.9rem; color: #000000; font-weight: 700;">OPENING...</span>`;
              }
              if (state === 'closing') {
                return `<span style="font-size: 0.9rem; color: #000000; font-weight: 700;">CLOSING...</span>`;
              }
              return '';
            ]]]
          tilt: |
            [[[
              const pos = entity.attributes.current_tilt_position || 0;
              return `<span style="font-size: 0.9rem; color: rgba(255,255,255,0.9);">${pos}%</span>`;
            ]]]
          battery: |
            [[[
              const battery = states['sensor.blind_tilt_5b8c_battery'];
              if (battery) {
                return `<span style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">ðŸ”‹ ${battery.state}%</span>`;
              }
              return '';
            ]]]
        styles:
          card:
            - height: 150px
            - border-radius: 16px
            - box-shadow: 0 3px 8px rgba(0,0,0,0.15)
            - background: |
                [[[
                  const state = entity.state;
                  const pos = entity.attributes.current_tilt_position || 0;
                  
                  // Bright green when opening
                  if (state === 'opening') {
                    return 'linear-gradient(135deg, #00FF00 0%, #00DD00 100%)';
                  }
                  
                  // Bright magenta when closing
                  if (state === 'closing') {
                    return 'linear-gradient(135deg, #FF00FF 0%, #DD00DD 100%)';
                  }
                  
                  // Closed = 0-5% or 95-100% (gray)
                  if (pos <= 5 || pos >= 95) {
                    return 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)';
                  }
                  
                  // Open = 6-94% (orange)
                  return 'linear-gradient(135deg, #F7971E 0%, #FFD200 100%)';
                ]]]
            - animation: |
                [[[
                  const state = entity.state;
                  if (state === 'opening' || state === 'closing') {
                    return 'pulse 1.5s ease-in-out infinite';
                  }
                  return 'none';
                ]]]
          icon:
            - width: 44px
            - color: |
                [[[
                  const state = entity.state;
                  const pos = entity.attributes.current_tilt_position || 0;
                  
                  // White during motion
                  if (state === 'opening' || state === 'closing') {
                    return '#FFFFFF';
                  }
                  
                  // Gray when closed
                  if (pos <= 5 || pos >= 95) {
                    return '#666';
                  }
                  
                  // Orange when open
                  return '#FFD200';
                ]]]
          name:
            - font-size: 1.0rem
            - font-weight: 500
            - margin-top: 8px
          grid:
            - grid-template-areas: '"i" "n" "motion" "tilt" "battery"'
            - grid-template-rows: 1fr auto auto auto auto
          custom_fields:
            motion:
              - justify-self: center
              - margin-top: 2px
            tilt:
              - justify-self: center
              - margin-top: 2px
            battery:
              - justify-self: center
              - margin-top: 2px
        icon: |
          [[[
            const pos = entity.attributes.current_tilt_position || 0;
            // Closed (0-5% or 95-100%) = blinds icon
            if (pos <= 5 || pos >= 95) {
              return 'mdi:blinds';
            }
            // Open (6-94%) = blinds-horizontal icon
            return 'mdi:blinds-horizontal';
          ]]]
